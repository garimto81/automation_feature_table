# PRD-0001 Checklist: 포커 핸드 자동 캡처 및 분류 시스템

## 문서 정보

| 항목 | 내용 |
|------|------|
| **PRD ID** | PRD-0001 |
| **제목** | 포커 피처 테이블 핸드 자동 캡처 및 분류 시스템 |
| **생성일** | 2025-12-23 |
| **수정일** | 2026-01-12 |
| **상태** | In Progress |
| **일정** | 2026-01-02 ~ 2026-03-02 (9주) |
| **진행률** | 32/40 (80%) |

---

## Phase 0: 사전 준비 (01/02 ~ 01/05)

### 1.1 PokerGFX API 확보
- [ ] PokerGFX 기술지원팀 연락
- [ ] JSON API 문서 요청
- [ ] API 접근 권한 확인 (엔터프라이즈 플랜)
- [ ] 테스트 환경 접근 권한 확보
- [ ] JSON 출력 형식 분석 및 문서화

### 1.2 Gemini API 설정
- [ ] Google AI Studio 계정 생성
- [ ] Gemini API 키 발급
- [ ] Live API 접근 권한 확인
- [ ] 비용 한도 설정

### 1.3 인프라 확인
- [ ] 각 테이블 카메라 RTSP/NDI 출력 확인
- [ ] 네트워크 대역폭 측정 (테이블당 5-10 Mbps)
- [ ] GPU 서버 준비 (RTX 3060+)

---

## Phase 1: Primary Layer 구축 (01/06 ~ 01/19) ✅

### 2.1 PokerGFX JSON 파서
- [x] JSON 스키마 정의 (`src/primary/pokergfx_client.py`)
- [x] 핸드 이벤트 파서 구현 (`_parse_hand_event`)
- [x] 핸드 시작/종료 감지 로직 (`hand_start`, `hand_end`, `hand_complete` 이벤트)
- [x] HandSession 데이터 클래스로 세션 추적
- [x] 카드 중복 검증 (52장 덱 유효성)
- [x] 멀티테이블 독립 세션 지원
- [x] 단위 테스트 작성 (`tests/test_pokergfx_client.py` - 42개)

### 2.2 핸드 분류 엔진
- [x] phevaluator 라이브러리 연동 (`src/primary/hand_classifier.py`)
- [x] 카드 문자열 → phevaluator 형식 변환기 (`convert_cards`)
- [x] 핸드 등급 분류 로직 (10단계) (`HandRank` enum)
- [x] 프리미엄 핸드 판별 로직 (등급 1-4) (`is_premium`)
- [x] 단위 테스트 작성 (`tests/test_hand_classifier.py`)

### 2.3 Primary 통합 테스트
- [x] 단일 테이블 연동 테스트 (테스트 완료)
- [ ] 핸드 감지 정확도 검증 (목표: >99%) - 실환경 테스트 필요
- [ ] 지연시간 측정 (목표: <100ms) - 실환경 테스트 필요

---

## Phase 2: Secondary Layer 구축 (01/20 ~ 02/02) ✅

### 3.1 비디오 캡처 파이프라인
- [x] OpenCV RTSP 스트림 캡처 구현 (`src/secondary/video_capture.py`)
- [x] 프레임 추출 (FPS 조절 가능, 기본 1 FPS)
- [x] JPEG 인코딩 최적화 (`to_jpeg` 메서드)

### 3.2 Gemini Live API 연동
- [x] WebSocket 연결 구현 (`src/secondary/gemini_live.py`)
- [x] 포커 분석 시스템 프롬프트 작성 (`SYSTEM_PROMPT`)
- [x] 프레임 전송 및 응답 파싱 (`analyze_frame`, `_parse_response`)
- [x] 세션 자동 재연결 (10분 제한 대응) (`_should_reconnect`)
- [x] 지수 백오프 재시도 (1s→2s→4s, max 8s)
- [x] 최대 3회 재연결 로직
- [x] 프레임 리사이즈 (640x360) - API 비용 66% 절감

### 3.3 AI 추론 테스트
- [x] 핸드 경계 감지 정확도 테스트 (`tests/test_secondary.py`)
- [ ] 카드 인식 정확도 테스트 - 실환경 테스트 필요
- [x] 신뢰도 임계값 조정 (기본 0.8) (`confidence_threshold`)

---

## Phase 3: Fusion Engine (02/03 ~ 02/09) ✅

### 4.1 교차 검증 로직
- [x] Primary/Secondary 결과 융합 엔진 (`src/fusion/engine.py`)
- [x] 4가지 케이스 분기 로직 구현 (`fuse` 메서드)
- [x] 리뷰 플래그 시스템 (`requires_review`, `cross_validated`)
- [x] 타임스탬프 동기화 검증 (기본 10초 허용)
- [x] hand_rank 없는 경우 MANUAL fallback
- [x] 상세 교차 검증 로깅

### 4.2 모니터링 (PRD-0008 참조)
- [x] 실시간 상태 대시보드 (Metabase + WebSocket) - PRD-0008 92%
- [x] 알림 시스템 (AlertManager) - PRD-0008 완료
- [x] 로그 수집 및 분석 (`logging` 모듈 적용)

---

## Phase 4: 멀티테이블 확장 (02/10 ~ 02/23)

### 5.1 병렬 처리
- [x] 3-5대 테이블 동시 처리 아키텍처 (`src/main.py`, `MultiTableFusionEngine`)
- [ ] 부하 테스트 및 최적화 - 실환경 테스트 필요
- [ ] 메모리/CPU 사용량 모니터링 - 미구현

### 5.2 출력 연동
- [ ] 실시간 오버레이 (WebSocket + HTML) - 미구현
- [ ] EDL/XML 클립 마커 생성 - 미구현

---

## Phase 5: 프로덕션 배포 (02/24 ~ 03/02)

### 6.1 최종 검증
- [ ] 실제 방송 환경 테스트
- [ ] 엔드투엔드 테스트 (전체 파이프라인)
- [ ] 장애 복구 테스트

### 6.2 문서화
- [ ] 운영 매뉴얼 작성
- [ ] 트러블슈팅 가이드
- [ ] API 문서화

---

## 성공 기준

| 지표 | 목표값 | 현재값 | 상태 |
|------|--------|--------|------|
| 핸드 감지 정확도 (Primary) | > 99% | - | - |
| 핸드 감지 정확도 (Secondary) | > 85% | - | - |
| 핸드 분류 정확도 | 100% | - | - |
| 시스템 가용성 | > 99.9% | - | - |
| 핸드 감지 지연시간 | < 2초 | - | - |

---

## 관련 PR

| PR | 설명 | 상태 |
|----|------|------|
| - | - | - |

---

## 변경 이력

| 날짜 | 변경 내용 | 작성자 |
|------|----------|--------|
| 2025-12-23 | 초기 체크리스트 생성 | Claude |
| 2025-12-24 | 구체적 일정 추가 (01/02~03/02, 9주) | Claude |
| 2026-01-05 | 구현 상태 반영 - Phase 1~3 완료, 53% 달성 | Claude |
| 2026-01-05 | 병렬 모듈 개선 반영 (Primary/Secondary/Fusion) - 68% 달성 | Claude |
| 2026-01-12 | PRD-0008 모니터링 대시보드 92% 완료 반영 | Claude |
| 2026-01-12 | PRD-0009 GFX JSON 시뮬레이터 89% 완료 반영 | Claude |
| 2026-01-12 | PRD-0010 NAS SMB 연동 BLOCKED, PRD-0011 대안 93% | Claude |
